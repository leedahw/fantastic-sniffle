<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>ZIM - Code Creativity</title>
    <script src="https://zimjs.org/cdn/1.3.2/createjs.js"></script>
    <script src="https://zimjs.org/cdn/cat/03/zim.js"></script>
    <script src="https://zimjs.org/cdn/Box2dWeb-2.1.a.3.min.js"></script>
    <script src="https://zimjs.org/cdn/physics_2.1"></script>
    <script>
      // https://zimjs.com - JavaScript Canvas Framework - Code Creativity!

      const frame = new Frame("fit", 1024, 1000, light, dark); //note change to 1000
      frame.on("ready", () => {
        const stage = frame.stage;
        let stageW = frame.width;
        let stageH = frame.height;

        // put your code here
        const physics = new Physics(0);
        // physics.remove(physics.borderTop); //remove border which is blocking/catching olives above canvas
        physics.drag();
        //physics.debug();
        
        const magnetism = .7; //higher number increases how fast magnetism works.
        const orbFriction = 3; //friction of ball on canvas. how quickly its force will dissapate
        const orbMagneticField = 30; //the size of the magnetic field aread around each side(positive & negative) of the orb
        const orbPolarization = 50; //best range [0-20]distance between the negative and positive poles inside the orbs

        class Orb {
          constructor(x, y, r,) {

            const orbLarge = (this.orbLarge = new Circle({
              radius: r,
              color: white,
              //percent: 50
            })
            .loc(x, y)
            .addPhysics({friction: 2}).outline());


            var magnetRadius = r/4;
            var magnetPolarization = r-magnetRadius;

            const positiveSide = (this.positiveSide = new Circle({
              radius: magnetRadius,
              color: black,
              //percent: 50
            })
              //.pos(600, 500)
              //.rot(180)
              .loc(x-magnetPolarization , y)
              .addPhysics({friction: 2}).outline());

            const negativeSide = (this.negativeSide = new Circle({
              radius: magnetRadius,
              color: red,
              //percent: 50
            })
              // .pos(0, 300)
              .loc(x+magnetPolarization, y)
              .addPhysics({friction: 2}).outline());

            // var pointTest1 = new Point(positiveSide.x, positiveSide.y);
            // zog(pointTest1.x,pointTest1.y);

            // var pointTest2 = new Point(negativeSide.x, negativeSide.y);
            // zog(pointTest2.x + 50,pointTest2.y +50);

            physics.join(
              positiveSide,
              negativeSide,
              null,
              new Point(negativeSide.x, negativeSide.y),
              null,
              null,
              null
            );
          }
        } //end of class

        const spacing = 30;
        const y = stageH / 2 - 100;

        const orbsArray = [];

        for (i=0; i < 2; i++ ) {

          var randX = rand(0, stageW, true, false); //using ZIM random function to get a random integer between 0 and stage Width.  
          var randY = rand(0, stageH, true, false); //using ZIM random function to get a random integer between 0 and stage Height.
          
          orbsArray.push(new Orb(randX, randY, 100));

          // const thingie = new StickIt(stageW / 2 + spacing * -2, y + 500);
          // const thingie2 = new StickIt(stageW / 2 + spacing * -2, y);


        }

        zog(orbsArray);
        //zog(orbsArray[0].negativeSide.physics);
        
        //zog(thingie.positiveSide.hitTestCircles(thingie2.negativeSide));

        // orbsArray[0].negativeSide.contact(orbsArray[0].positiveSide.physics, orbsArray[0].negativeSide.physics);
          
        
        // if (orbsArray[0].negativeSide.contact()) zog("contact on orb " + 0 )

        Ticker.add(() => {

          

          for (i=0; i < orbsArray.length; i++){
            
            // orbsArray[i].positiveSide.outline();
            // orbsArray[i].negativeSide.outline();

            for (j=0; j < orbsArray.length; j++){

                if (orbsArray[i].positiveSide.hitTestCircles(orbsArray[j].negativeSide, orbMagneticField)) {
                   // zog("attracting orb: " + i + " to orb: " + j);

                    orbsArray[i].positiveSide.force(
                        (orbsArray[j].negativeSide.x - orbsArray[i].positiveSide.x)*magnetism,
                        (orbsArray[j].negativeSide.y - orbsArray[i].positiveSide.y)*magnetism
                        );
                    orbsArray[j].negativeSide.force(
                        (orbsArray[i].positiveSide.x - orbsArray[j].negativeSide.x)*magnetism,
                        (orbsArray[i].positiveSide.y - orbsArray[j].negativeSide.y)*magnetism
                    );

                } else if(orbsArray[i].negativeSide.hitTestCircles(orbsArray[j].negativeSide, orbMagneticField)) { 
                    // zog("repelling negativeSide-orb: " + i + " to negativeSide-orb: " + j);

                    orbsArray[i].negativeSide.force(
                        -(orbsArray[j].negativeSide.x - orbsArray[i].negativeSide.x)*magnetism,
                        -(orbsArray[j].negativeSide.y - orbsArray[i].negativeSide.y)*magnetism
                    );
                    orbsArray[j].negativeSide.force(
                        -(orbsArray[i].negativeSide.x - orbsArray[j].negativeSide.x)*magnetism,
                        -(orbsArray[i].negativeSide.y - orbsArray[j].negativeSide.y)*magnetism
                    );

                } else if(orbsArray[i].positiveSide.hitTestCircles(orbsArray[j].positiveSide, orbMagneticField)) { 
                    // zog("repelling positiveSide-orb: " + i + " to positiveSide-orb: " + j);

                    orbsArray[i].positiveSide.force(
                        -(orbsArray[j].positiveSide.x - orbsArray[i].positiveSide.x)*magnetism,
                        -(orbsArray[j].positiveSide.y - orbsArray[i].positiveSide.y)*magnetism
                    );
                    orbsArray[j].positiveSide.force(
                        -(orbsArray[i].positiveSide.x - orbsArray[j].positiveSide.x)*magnetism,
                        -(orbsArray[i].positiveSide.y - orbsArray[j].positiveSide.y)*magnetism
                    );

                }

                stage.update();
            }
        }
         
          
        });


        stage.update();
      }); //end of ready
    </script>
    <meta name="viewport" content="width=device-width, user-scalable=no" />
  </head>
  <body></body>
</html>
